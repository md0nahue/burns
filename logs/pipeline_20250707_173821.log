
=== Pipeline started at: 2025-07-07T17:38:21-07:00 ===
🎬 Burns - Audio to Ken Burns Video Pipeline
============================================================
🔍 Checking for existing video in S3...
🆕 No existing video found in S3, generating new video...
✅ Found audio file: fireship.mp3
📊 File size: 2.66 MB

🚀 Initializing video generator...
🎬 Local Video Service initialized
  📁 Temp directory: /var/folders/h6/gt987qh93hs085p28xhy8z840000gn/T/d20250707-53385-mcmtwz
  🎥 FFmpeg path: ffmpeg

⚙️  Generation options:
  📐 Resolution: 1080p
  🎬 FPS: 24
  🎭 Ken Burns Effect: true
  🔄 Smooth Transitions: true
  ⏱️  Image Duration: 4.0s
  🌊 Transition Duration: 1.0s
  🔍 Zoom Factor: 1.4x
  📹 Pan Speed: 0.3
  💾 Image Caching: true
  💾 Transcription Caching: true
  💾 Analysis Caching: true
  🔄 Force Refresh: false

============================================================
🎬 STARTING KEN BURNS VIDEO GENERATION
============================================================

📝 Step 1: Processing audio and transcription...
🎵 Transcribing audio content...
⏱️  Step 1 started at: 17:38:22
🎬 Starting Ken Burns video generation
  📁 Audio file: fireship.mp3
  🆔 Project ID: fireship
  ⚙️  Options: {:resolution=>"1080p", :fps=>24, :test_mode=>false, :ken_burns_effect=>true, :smooth_transitions=>true, :image_duration=>4.0, :transition_duration=>1.0, :zoom_factor=>1.4, :pan_speed=>0.3, :cache_images=>true, :cache_transcription=>true, :cache_analysis=>true, :force=>false}

📝 Step 1: Transcribing audio to get text segments...
  💾 Using cached transcription from S3
  ✅ Transcription complete: 54 segments

🎨 Step 2: Analyzing text content to generate image queries...
  🧠 Analyzing content with Gemini to generate image queries...
  🎨 Analyzing content for image generation...
🎨 Analyzing content for image generation...
🧠 Analyzing content for image generation using Gemini...
    📁 Using cached content analysis from: cache/gemini_analysis_7d1a1cd6404a8cbf07ea311f8367ad0f.json
✅ Content analysis completed:
  📊 Total segments: 54
  🖼️  Segments with images: 54
  🔍 Total image queries: 163
  📈 Average confidence: -0.093
  ✅ Analysis complete: 163 image queries generated

🖼️  Step 3: Generating images using the queries...
  💾 Using cached image generation from S3
  ✅ Image generation complete: 54 images found

📋 Step 4: Creating project manifest with all data...
  📋 Creating project manifest...
📤 Uploading project manifest: fireship
✅ Project manifest uploaded: s3://burns-videos/projects/fireship/manifest.json
  ✅ Manifest created successfully

🎥 Step 5: Generating final Ken Burns video...
  🎥 Generating final video using AWS Lambda for parallel processing...
📥 Getting project manifest: fireship
✅ Project manifest retrieved: s3://burns-videos/projects/fireship/manifest.json
    📝 Processing 54 segments concurrently...
🚀 Generating video segments concurrently for project: fireship
  📝 Segments: 54
  ⚡ Concurrency: 25 (conservative to prevent Lambda /tmp issues)
    Debug - Segment 0: id=0, start_time=0, end_time=4.82
    Debug - Segment 1: id=1, start_time=5.02, end_time=6.04
    Debug - Segment 2: id=2, start_time=6.18, end_time=8.24
    Debug - Segment 3: id=3, start_time=8.36, end_time=10.14
    Debug - Segment 4: id=4, start_time=10.4, end_time=14.44
    Debug - Segment 5: id=5, start_time=14.62, end_time=18.74
    Debug - Segment 6: id=6, start_time=18.86, end_time=20.56
    Debug - Segment 7: id=7, start_time=20.82, end_time=22.96
    Debug - Segment 8: id=8, start_time=23.04, end_time=25.34
    Debug - Segment 9: id=9, start_time=25.34, end_time=28.32
    Debug - Segment 10: id=10, start_time=28.32, end_time=34.56
    Debug - Segment 11: id=11, start_time=34.62, end_time=39.92
    Debug - Segment 12: id=12, start_time=40.28, end_time=47.38
    Debug - Segment 13: id=13, start_time=47.5, end_time=50.8
    Debug - Segment 14: id=14, start_time=51.02, end_time=55.22
    Debug - Segment 15: id=15, start_time=55.22, end_time=69.342
    Debug - Segment 16: id=16, start_time=69.942, end_time=74.722
    Debug - Segment 17: id=17, start_time=74.882, end_time=79.542
    Debug - Segment 18: id=18, start_time=79.662, end_time=83.962006
    Debug - Segment 19: id=19, start_time=84.182, end_time=87.042
    Debug - Segment 20: id=20, start_time=87.202, end_time=89.922
    Debug - Segment 21: id=21, start_time=90.102005, end_time=92.142
    Debug - Segment 22: id=22, start_time=92.482, end_time=96.802
    Debug - Segment 23: id=23, start_time=97.082, end_time=99.922
    Debug - Segment 24: id=24, start_time=99.982, end_time=101.562
    Debug - Segment 25: id=25, start_time=101.942, end_time=105.701996
    Debug - Segment 26: id=26, start_time=105.701996, end_time=109.562
    Debug - Segment 27: id=27, start_time=109.562, end_time=113.002
    Debug - Segment 28: id=28, start_time=113.002, end_time=116.062
    Debug - Segment 29: id=29, start_time=116.062, end_time=118.342
    Debug - Segment 30: id=30, start_time=118.342, end_time=132.524
    Debug - Segment 31: id=31, start_time=132.524, end_time=137.244
    Debug - Segment 32: id=32, start_time=137.244, end_time=141.804
    Debug - Segment 33: id=33, start_time=141.804, end_time=147.12401
    Debug - Segment 34: id=34, start_time=147.12401, end_time=152.164
    Debug - Segment 35: id=35, start_time=152.164, end_time=156.444
    Debug - Segment 36: id=36, start_time=156.444, end_time=160.564
    Debug - Segment 37: id=37, start_time=160.764, end_time=164.824
    Debug - Segment 38: id=38, start_time=164.824, end_time=168.404
    Debug - Segment 39: id=39, start_time=168.62401, end_time=173.024
    Debug - Segment 40: id=40, start_time=173.024, end_time=180.024
    Debug - Segment 41: id=41, start_time=180.024, end_time=193.566
    Debug - Segment 42: id=42, start_time=193.726, end_time=198.88599
    Debug - Segment 43: id=43, start_time=198.88599, end_time=203.306
    Debug - Segment 44: id=44, start_time=203.306, end_time=206.846
    Debug - Segment 45: id=45, start_time=206.846, end_time=211.306
    Debug - Segment 46: id=46, start_time=211.306, end_time=216.726
    Debug - Segment 47: id=47, start_time=216.726, end_time=221.006
    Debug - Segment 48: id=48, start_time=221.12599, end_time=225.746
    Debug - Segment 49: id=49, start_time=225.986, end_time=230.926
    Debug - Segment 50: id=50, start_time=230.926, end_time=235.506
    Debug - Segment 51: id=51, start_time=235.506, end_time=239.68599
    Debug - Segment 52: id=52, start_time=239.68599, end_time=243.366
    Debug - Segment 53: id=53, start_time=243.44598, end_time=246.806
  ⏳ Waiting for 54 segments to complete...
  📹 Processing segment 0 (1/54) - Duration: 4.82s
    Debug - Payload: project_id=fireship, segment_id=0, segment_index=0, images=Array, duration=4.82, start_time=0.0, end_time=4.82
  📹 Processing segment 1 (2/54) - Duration: 1.02s
    Debug - Payload: project_id=fireship, segment_id=1, segment_index=1, images=Array, duration=1.0200000000000005, start_time=5.02, end_time=6.04
  📹 Processing segment 2 (3/54) - Duration: 2.06s
    Debug - Payload: project_id=fireship, segment_id=2, segment_index=2, images=Array, duration=2.0600000000000005, start_time=6.18, end_time=8.24
  📹 Processing segment 3 (4/54) - Duration: 1.78s
    Debug - Payload: project_id=fireship, segment_id=3, segment_index=3, images=Array, duration=1.7800000000000011, start_time=8.36, end_time=10.14
  📹 Processing segment 4 (5/54) - Duration: 4.04s
    Debug - Payload: project_id=fireship, segment_id=4, segment_index=4, images=Array, duration=4.039999999999999, start_time=10.4, end_time=14.44
  📹 Processing segment 5 (6/54) - Duration: 4.12s
    Debug - Payload: project_id=fireship, segment_id=5, segment_index=5, images=Array, duration=4.119999999999999, start_time=14.62, end_time=18.74
  📹 Processing segment 6 (7/54) - Duration: 1.7s
    Debug - Payload: project_id=fireship, segment_id=6, segment_index=6, images=Array, duration=1.6999999999999993, start_time=18.86, end_time=20.56
  📹 Processing segment 7 (8/54) - Duration: 2.14s
    Debug - Payload: project_id=fireship, segment_id=7, segment_index=7, images=Array, duration=2.1400000000000006, start_time=20.82, end_time=22.96
  📹 Processing segment 8 (9/54) - Duration: 2.3s
    Debug - Payload: project_id=fireship, segment_id=8, segment_index=8, images=Array, duration=2.3000000000000007, start_time=23.04, end_time=25.34p, segment_id=8, segment_index=8, images=Array, duration=2.3000000000000007, start_time=23.04, end_time=25.34  📹 Processing segment 21 (22/54) - Duration: 2.04s
    Debug - Payload: project_id=fireship, segment_id=21, segment_index=21, images=Array, duration=2.0399949999999905, start_time=90.102005, end_time=92.142
  📹 Processing segment 22 (23/54) - Duration: 4.32s
  📹 Processing segment 24 (25/54) - Duration: 1.58s
    Debug - Payload: project_id=fireship, segment_id=24, segment_index=24, images=Array, duration=1.5799999999999983, start_time=99.982, end_time=101.562

    Debug - Payload: project_id=fireship, segment_id=22, segment_index=22, images=Array, duration=4.320000000000007, start_time=92.482, end_time=96.802
    Debug - Payload: project_id=fireship, segment_id=10, segment_index=10, images=Array, duration=6.240000000000002, start_time=28.32, end_time=34.56
  📹 Processing segment 11 (12/54) - Duration: 5.3s
    Debug - Payload: project_id=fireship, segment_id=11, segment_index=11, images=Array, duration=5.300000000000004, start_time=34.62, end_time=39.92
  📹 Processing segment 12 (13/54) - Duration: 7.1s
  📹 Processing segment 13 (14/54) - Duration: 3.3s12, segment_index=12, images=Array, duration=7.100000000000001, start_time=40.28, end_time=47.38
  📹 Processing segment 13 (14/54) - Duration: 3.3s
  📹 Processing segment 15 (16/54) - Duration: 14.12s, segment_index=13, images=Array, duration=3.299999999999997, start_time=47.5, end_time=50.8
  📹 Processing segment 16 (17/54) - Duration: 4.78s  📹 Processing segment 17 (18/54) - Duration: 4.66s

    Debug - Payload: project_id=fireship, segment_id=16, segment_index=16, images=Array, duration=4.780000000000001, start_time=69.942, end_time=74.722
  📹 Processing segment 18 (19/54) - Duration: 4.3s17, segment_index=17, images=Array, duration=4.659999999999997, start_time=74.882, end_time=79.542
  📹 Processing segment 18 (19/54) - Duration: 4.3s
  📹 Processing segment 20 (21/54) - Duration: 2.72s
    Debug - Payload: project_id=fireship, segment_id=20, segment_index=20, images=Array, duration=2.719999999999999, start_time=87.202, end_time=89.922
    Debug - Payload: project_id=fireship, segment_id=18, segment_index=18, images=Array, duration=4.300005999999996, start_time=79.662, end_time=83.962006
  📹 Processing segment 23 (24/54) - Duration: 2.84s
    Debug - Payload: project_id=fireship, segment_id=23, segment_index=23, images=Array, duration=2.8400000000000034, start_time=97.082, end_time=99.922
    Debug - Payload: project_id=fireship, segment_id=9, segment_index=9, images=Array, duration=2.9800000000000004, start_time=25.34, end_time=28.32
  📹 Processing segment 14 (15/54) - Duration: 4.2s
    Debug - Payload: project_id=fireship, segment_id=14, segment_index=14, images=Array, duration=4.199999999999996, start_time=51.02, end_time=55.22
  📹 Processing segment 15 (16/54) - Duration: 14.12s
    Debug - Payload: project_id=fireship, segment_id=15, segment_index=15, images=Array, duration=14.122, start_time=55.22, end_time=69.342
  📹 Processing segment 19 (20/54) - Duration: 2.86s
    Debug - Payload: project_id=fireship, segment_id=19, segment_index=19, images=Array, duration=2.8599999999999994, start_time=84.182, end_time=87.042
    💾 Segment 0 cached (0.097s saved)
  📹 Processing segment 25 (26/54) - Duration: 3.76s
    Debug - Payload: project_id=fireship, segment_id=25, segment_index=25, images=Array, duration=3.759996000000001, start_time=101.942, end_time=105.701996
    💾 Segment 25 cached (0.121s saved)
  📹 Processing segment 26 (27/54) - Duration: 3.86s
    Debug - Payload: project_id=fireship, segment_id=26, segment_index=26, images=Array, duration=3.8600040000000035, start_time=105.701996, end_time=109.562
    💾 Segment 2 cached (0.293s saved)
  📹 Processing segment 27 (28/54) - Duration: 3.44s
    Debug - Payload: project_id=fireship, segment_id=27, segment_index=27, images=Array, duration=3.4399999999999977, start_time=109.562, end_time=113.002
    💾 Segment 3 cached (0.3s saved)
  📹 Processing segment 28 (29/54) - Duration: 3.06s
    Debug - Payload: project_id=fireship, segment_id=28, segment_index=28, images=Array, duration=3.0600000000000023, start_time=113.002, end_time=116.062
    💾 Segment 17 cached (0.306s saved)
  📹 Processing segment 29 (30/54) - Duration: 2.28s
    Debug - Payload: project_id=fireship, segment_id=29, segment_index=29, images=Array, duration=2.280000000000001, start_time=116.062, end_time=118.342
    💾 Segment 26 cached (0.098s saved)
    💾 Segment 7 cached (0.309s saved)
  📹 Processing segment 30 (31/54) - Duration: 14.18s
    Debug - Payload: project_id=fireship, segment_id=30, segment_index=30, images=Array, duration=14.182000000000002, start_time=118.342, end_time=132.524
    💾 Segment 6 cached (0.311s saved)
  📹 Processing segment 31 (32/54) - Duration: 4.72s
  📹 Processing segment 32 (33/54) - Duration: 4.56s
    Debug - Payload: project_id=fireship, segment_id=32, segment_index=32, images=Array, duration=4.560000000000002, start_time=137.244, end_time=141.804
    Debug - Payload: project_id=fireship, segment_id=31, segment_index=31, images=Array, duration=4.719999999999999, start_time=132.524, end_time=137.244
    💾 Segment 22 cached (0.311s saved)
    💾 Segment 13 cached (0.312s saved)
  📹 Processing segment 33 (34/54) - Duration: 5.32s
    Debug - Payload: project_id=fireship, segment_id=33, segment_index=33, images=Array, duration=5.320009999999996, start_time=141.804, end_time=147.12401
  📹 Processing segment 34 (35/54) - Duration: 5.04s
    Debug - Payload: project_id=fireship, segment_id=34, segment_index=34, images=Array, duration=5.039989999999989, start_time=147.12401, end_time=152.164
    💾 Segment 12 cached (0.314s saved)
  📹 Processing segment 35 (36/54) - Duration: 4.28s
    Debug - Payload: project_id=fireship, segment_id=35, segment_index=35, images=Array, duration=4.280000000000001, start_time=152.164, end_time=156.444
    💾 Segment 14 cached (0.315s saved)
  📹 Processing segment 36 (37/54) - Duration: 4.12s
    Debug - Payload: project_id=fireship, segment_id=36, segment_index=36, images=Array, duration=4.1200000000000045, start_time=156.444, end_time=160.564
    💾 Segment 8 cached (0.316s saved)
  📹 Processing segment 37 (38/54) - Duration: 4.06s
    Debug - Payload: project_id=fireship, segment_id=37, segment_index=37, images=Array, duration=4.060000000000002, start_time=160.764, end_time=164.824
    💾 Segment 24 cached (0.318s saved)
    💾 Segment 1 cached (0.327s saved)
  📹 Processing segment 38 (39/54) - Duration: 3.58s
    Debug - Payload: project_id=fireship, segment_id=38, segment_index=38, images=Array, duration=3.579999999999984, start_time=164.824, end_time=168.404
    💾 Segment 10 cached (0.319s saved)
  📹 Processing segment 39 (40/54) - Duration: 4.4s
    Debug - Payload: project_id=fireship, segment_id=39, segment_index=39, images=Array, duration=4.3999900000000025, start_time=168.62401, end_time=173.024
  📹 Processing segment 40 (41/54) - Duration: 7.0s
    Debug - Payload: project_id=fireship, segment_id=40, segment_index=40, images=Array, duration=7.0, start_time=173.024, end_time=180.024
    💾 Segment 5 cached (0.324s saved)
  📹 Processing segment 41 (42/54) - Duration: 13.54s
    Debug - Payload: project_id=fireship, segment_id=41, segment_index=41, images=Array, duration=13.542000000000002, start_time=180.024, end_time=193.566
    💾 Segment 4 cached (0.326s saved)
    💾 Segment 9 cached (0.322s saved)
  📹 Processing segment 42 (43/54) - Duration: 5.16s
    Debug - Payload: project_id=fireship, segment_id=42, segment_index=42, images=Array, duration=5.159989999999993, start_time=193.726, end_time=198.88599
  📹 Processing segment 43 (44/54) - Duration: 4.42s
    Debug - Payload: project_id=fireship, segment_id=43, segment_index=43, images=Array, duration=4.420010000000019, start_time=198.88599, end_time=203.306
    💾 Segment 15 cached (0.324s saved)
  📹 Processing segment 44 (45/54) - Duration: 3.54s
    Debug - Payload: project_id=fireship, segment_id=44, segment_index=44, images=Array, duration=3.539999999999992, start_time=203.306, end_time=206.846
    💾 Segment 16 cached (0.326s saved)
    💾 Segment 11 cached (0.326s saved)
  📹 Processing segment 45 (46/54) - Duration: 4.46s
    Debug - Payload: project_id=fireship, segment_id=45, segment_index=45, images=Array, duration=4.460000000000008, start_time=206.846, end_time=211.306
    💾 Segment 20 cached (0.327s saved)
  📹 Processing segment 46 (47/54) - Duration: 5.42s
    Debug - Payload: project_id=fireship, segment_id=46, segment_index=46, images=Array, duration=5.4199999999999875, start_time=211.306, end_time=216.726
  📹 Processing segment 47 (48/54) - Duration: 4.28s
    Debug - Payload: project_id=fireship, segment_id=47, segment_index=47, images=Array, duration=4.280000000000001, start_time=216.726, end_time=221.006
    💾 Segment 23 cached (0.334s saved)
    💾 Segment 21 cached (0.334s saved)
  📹 Processing segment 48 (49/54) - Duration: 4.62s
  📹 Processing segment 49 (50/54) - Duration: 4.94s
    Debug - Payload: project_id=fireship, segment_id=49, segment_index=49, images=Array, duration=4.939999999999998, start_time=225.986, end_time=230.926
    Debug - Payload: project_id=fireship, segment_id=48, segment_index=48, images=Array, duration=4.620010000000008, start_time=221.12599, end_time=225.746
    💾 Segment 18 cached (0.338s saved)
  📹 Processing segment 50 (51/54) - Duration: 4.58s
    Debug - Payload: project_id=fireship, segment_id=50, segment_index=50, images=Array, duration=4.5800000000000125, start_time=230.926, end_time=235.506
    💾 Segment 27 cached (0.099s saved)
  📹 Processing segment 51 (52/54) - Duration: 4.18s
    Debug - Payload: project_id=fireship, segment_id=51, segment_index=51, images=Array, duration=4.179990000000004, start_time=235.506, end_time=239.68599
    💾 Segment 28 cached (0.1s saved)
  📹 Processing segment 52 (53/54) - Duration: 3.68s
    Debug - Payload: project_id=fireship, segment_id=52, segment_index=52, images=Array, duration=3.68001000000001, start_time=239.68599, end_time=243.366
    💾 Segment 29 cached (0.09s saved)
  📹 Processing segment 53 (54/54) - Duration: 3.36s
    Debug - Payload: project_id=fireship, segment_id=53, segment_index=53, images=Array, duration=3.36002000000002, start_time=243.44598, end_time=246.806
    💾 Segment 30 cached (0.098s saved)
    💾 Segment 31 cached (0.097s saved)
    💾 Segment 32 cached (0.099s saved)
    💾 Segment 33 cached (0.097s saved)
    💾 Segment 37 cached (0.094s saved)
    💾 Segment 34 cached (0.101s saved)
    💾 Segment 39 cached (0.095s saved)
    💾 Segment 35 cached (0.102s saved)
    💾 Segment 40 cached (0.096s saved)
    💾 Segment 38 cached (0.098s saved)
    💾 Segment 42 cached (0.095s saved)
    💾 Segment 43 cached (0.095s saved)
    💾 Segment 44 cached (0.099s saved)
    💾 Segment 41 cached (0.103s saved)
    💾 Segment 46 cached (0.097s saved)
    💾 Segment 45 cached (0.097s saved)
    💾 Segment 19 cached (0.428s saved)
    💾 Segment 36 cached (0.113s saved)
    💾 Segment 47 cached (0.101s saved)