
=== Pipeline started at: 2025-07-06T20:56:09-07:00 ===
🎬 Burns - Audio to Ken Burns Video Pipeline
============================================================
✅ Found audio file: cooper.mp3
📊 File size: 6.68 MB

🚀 Initializing video generator...
🎬 Local Video Service initialized
  📁 Temp directory: /var/folders/h6/gt987qh93hs085p28xhy8z840000gn/T/d20250706-28298-4e2yq3
  🎥 FFmpeg path: ffmpeg

⚙️  Generation options:
  📐 Resolution: 1080p
  🎬 FPS: 24
  🎭 Ken Burns Effect: true
  🔄 Smooth Transitions: true
  ⏱️  Image Duration: 3.0s
  🌊 Transition Duration: 1.0s
  🔍 Zoom Factor: 1.2x
  📹 Pan Speed: 0.5
  💾 Image Caching: true
  💾 Transcription Caching: false
  💾 Analysis Caching: false
  🔄 Force Refresh: true

============================================================
🎬 STARTING KEN BURNS VIDEO GENERATION
============================================================

📝 Step 1: Processing audio and transcription...
🎵 Transcribing audio content...
🎬 Starting Ken Burns video generation
  📁 Audio file: cooper.mp3
  🆔 Project ID: cooper
  ⚙️  Options: {:resolution=>"1080p", :fps=>24, :test_mode=>false, :ken_burns_effect=>true, :smooth_transitions=>true, :image_duration=>3.0, :transition_duration=>1.0, :zoom_factor=>1.2, :pan_speed=>0.5, :cache_images=>true, :cache_transcription=>false, :cache_analysis=>false, :force=>true}

📝 Step 1: Transcribing audio to get text segments...
  🎤 Processing audio with Whisper...
  🎵 Processing audio file...
    🎤 Processing audio with AudioProcessor...
🎤 Processing audio file: cooper.mp3
    📁 Using cached transcription from: cache/cooper.json
✅ Transcription completed: 142 segments
📊 Total duration: 629.086 seconds
📝 Total words: 0
📤 Uploading audio file: cooper.mp3
✅ Audio file uploaded: s3://burns-videos/projects/cooper/audio/cooper.mp3
  ✅ Transcription complete: 142 segments

🎨 Step 2: Analyzing text content to generate image queries...
  🧠 Analyzing content with Gemini to generate image queries...
  🎨 Analyzing content for image generation...
🎨 Analyzing content for image generation...
🧠 Analyzing content for image generation using Gemini...
  📝 Analyzing 142 segments in batches of 10...
    🔄 Processing batch 1/15 (10 segments)
    🔄 Processing batch 2/15 (10 segments)
    🔄 Processing batch 3/15 (10 segments)
    🔄 Processing batch 4/15 (10 segments)
    🔄 Processing batch 5/15 (10 segments)
    🔄 Processing batch 6/15 (10 segments)
    🔄 Processing batch 7/15 (10 segments)
    🔄 Processing batch 8/15 (10 segments)
    🔄 Processing batch 9/15 (10 segments)
    🔄 Processing batch 10/15 (10 segments)
    🔄 Processing batch 11/15 (10 segments)
    🔄 Processing batch 12/15 (10 segments)
    🔄 Processing batch 13/15 (10 segments)
    🔄 Processing batch 14/15 (10 segments)
    🔄 Processing batch 15/15 (2 segments)
    💾 Caching content analysis to: cache/gemini_analysis_4cd505ea14f12cd2fe8acba3e0e7640a.json
✅ Content analysis completed: 142 segments processed
✅ Content analysis completed:
  📊 Total segments: 142
  🖼️  Segments with images: 70
  🔍 Total image queries: 70
  📈 Average confidence: -0.158
  ✅ Analysis complete: 70 image queries generated

🖼️  Step 3: Generating images using the queries...
  🔍 Searching for images using image service providers...
  🖼️  Generating images for segments...
    📝 Processing segment: 0
    📝 Processing segment: 0
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 1
    📝 Processing segment: 1
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 2
    📝 Processing segment: 2
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 3
    📝 Processing segment: 3
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 4
    📝 Processing segment: 4
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 5
    📝 Processing segment: 5
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 6
    📝 Processing segment: 6
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 7
    📝 Processing segment: 7
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 8
    📝 Processing segment: 8
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 9
    📝 Processing segment: 9
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 10
    📝 Processing segment: 10
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 11
    📝 Processing segment: 11
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 12
    📝 Processing segment: 12
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 13
    📝 Processing segment: 13
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 14
    📝 Processing segment: 14
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 15
    📝 Processing segment: 15
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 16
    📝 Processing segment: 16
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 17
    📝 Processing segment: 17
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 18
    📝 Processing segment: 18
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 19
    📝 Processing segment: 19
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: []
      Debug - final image_queries: []
      ⚠️  No image queries for segment
      ✅ Generated 0 images
    📝 Processing segment: 20
    📝 Processing segment: 20
      Debug - segment keys: [:id, :start_time, :end_time, :text, :confidence, :no_speech_prob, :compression_ratio, :words, :image_queries, :has_images]
      Debug - image_queries: ["colleagues in office meeting"]
      Debug - final image_queries: ["colleagues in office meeting"]

============================================================
❌ VIDEO GENERATION FAILED
============================================================
Error: Step 3 failed - Image generation: Image generation error: undefined method `mkdir_p' for Dir:Class

    Dir.mkdir_p(cache_dir) unless Dir.exist?(cache_dir)
       ^^^^^^^^
Did you mean?  mkdir

🔧 Troubleshooting tips:
  • Check your API keys are properly configured
  • Ensure AWS services are accessible
  • Verify the audio file is in a supported format
  • Check network connectivity
  • Try running with test_mode: true for debugging
============================================================
